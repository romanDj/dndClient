{"version":3,"sources":["reducers/common.js","reducer.js","constants/actionTypes.js","store.js","middleware.js","components/Header.js","components/Home.js","components/Profile.js","components/Spells.js","components/App.js","index.js"],"names":["history","defaultState","appName","token","viewChangeCounter","state","action","type","appLoaded","currentUser","payload","user","redirectTo","redirectUrl","article","slug","error","createBrowserHistory","store","createStore","combineReducers","common","router","connectRouter","compose","applyMiddleware","thunk","routerMiddleware","next","v","then","dispatch","subtype","currentView","getState","skipTracking","res","currentState","console","log","promise","response","body","window","localStorage","setItem","Header","props","current","handleClick","bind","e","this","setState","key","push","onClick","selectedKeys","mode","Item","React","Component","Home","className","Profile","Spells","App","nextProps","onRedirect","getItem","exact","path","component","render","connect","onLoad","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.06cf1dfa.chunk.js","sourcesContent":["import {\r\n    APP_LOAD,\r\n    REDIRECT,\r\n    LOGOUT,\r\n    ARTICLE_SUBMITTED,\r\n    SETTINGS_SAVED,\r\n    LOGIN,\r\n    REGISTER,\r\n    DELETE_ARTICLE,\r\n    ARTICLE_PAGE_UNLOADED,\r\n    EDITOR_PAGE_UNLOADED,\r\n    HOME_PAGE_UNLOADED,\r\n    PROFILE_PAGE_UNLOADED,\r\n    PROFILE_FAVORITES_PAGE_UNLOADED,\r\n    SETTINGS_PAGE_UNLOADED,\r\n    LOGIN_PAGE_UNLOADED,\r\n    REGISTER_PAGE_UNLOADED\r\n} from '../constants/actionTypes';\r\n\r\nconst defaultState = {\r\n    appName: 'Conduit',\r\n    token: null,\r\n    viewChangeCounter: 0\r\n};\r\n\r\nexport default (state = defaultState, action) => {\r\n    switch (action.type) {\r\n        case APP_LOAD:\r\n            return {\r\n                ...state,\r\n                token: action.token || null,\r\n                appLoaded: true,\r\n                currentUser: action.payload ? action.payload.user : null\r\n            };\r\n        case REDIRECT:\r\n            return { ...state, redirectTo: null };\r\n        case LOGOUT:\r\n            return { ...state, redirectTo: '/', token: null, currentUser: null };\r\n        case ARTICLE_SUBMITTED:\r\n            const redirectUrl = `/article/${action.payload.article.slug}`;\r\n            return { ...state, redirectTo: redirectUrl };\r\n        case SETTINGS_SAVED:\r\n            return {\r\n                ...state,\r\n                redirectTo: action.error ? null : '/',\r\n                currentUser: action.error ? null : action.payload.user\r\n            };\r\n        case LOGIN:\r\n        case REGISTER:\r\n            return {\r\n                ...state,\r\n                redirectTo: action.error ? null : '/',\r\n                token: action.error ? null : action.payload.user.token,\r\n                currentUser: action.error ? null : action.payload.user\r\n            };\r\n        case DELETE_ARTICLE:\r\n            return { ...state, redirectTo: '/' };\r\n        case ARTICLE_PAGE_UNLOADED:\r\n        case EDITOR_PAGE_UNLOADED:\r\n        case HOME_PAGE_UNLOADED:\r\n        case PROFILE_PAGE_UNLOADED:\r\n        case PROFILE_FAVORITES_PAGE_UNLOADED:\r\n        case SETTINGS_PAGE_UNLOADED:\r\n        case LOGIN_PAGE_UNLOADED:\r\n        case REGISTER_PAGE_UNLOADED:\r\n            return { ...state, viewChangeCounter: state.viewChangeCounter + 1 };\r\n        default:\r\n            return state;\r\n    }\r\n};","import { combineReducers } from 'redux';\r\nimport { connectRouter  } from 'connected-react-router';\r\nimport common from \"./reducers/common\";\r\n\r\n//здесь остальные редьюсеры можно добавлять\r\n\r\nexport default (history) => combineReducers({\r\n    common,\r\n    router: connectRouter(history)\r\n});","\r\nexport const APP_LOAD = 'APP_LOAD';\r\nexport const REDIRECT = 'REDIRECT';\r\nexport const ARTICLE_SUBMITTED = 'ARTICLE_SUBMITTED';\r\nexport const SETTINGS_SAVED = 'SETTINGS_SAVED';\r\nexport const DELETE_ARTICLE = 'DELETE_ARTICLE';\r\nexport const SETTINGS_PAGE_UNLOADED = 'SETTINGS_PAGE_UNLOADED';\r\nexport const HOME_PAGE_LOADED = 'HOME_PAGE_LOADED';\r\nexport const HOME_PAGE_UNLOADED = 'HOME_PAGE_UNLOADED';\r\nexport const ARTICLE_PAGE_LOADED = 'ARTICLE_PAGE_LOADED';\r\nexport const ARTICLE_PAGE_UNLOADED = 'ARTICLE_PAGE_UNLOADED';\r\nexport const ADD_COMMENT = 'ADD_COMMENT';\r\nexport const DELETE_COMMENT = 'DELETE_COMMENT';\r\nexport const ARTICLE_FAVORITED = 'ARTICLE_FAVORITED';\r\nexport const ARTICLE_UNFAVORITED = 'ARTICLE_UNFAVORITED';\r\nexport const SET_PAGE = 'SET_PAGE';\r\nexport const APPLY_TAG_FILTER = 'APPLY_TAG_FILTER';\r\nexport const CHANGE_TAB = 'CHANGE_TAB';\r\nexport const PROFILE_PAGE_LOADED = 'PROFILE_PAGE_LOADED';\r\nexport const PROFILE_PAGE_UNLOADED = 'PROFILE_PAGE_UNLOADED';\r\nexport const LOGIN = 'LOGIN';\r\nexport const LOGOUT = 'LOGOUT';\r\nexport const REGISTER = 'REGISTER';\r\nexport const LOGIN_PAGE_UNLOADED = 'LOGIN_PAGE_UNLOADED';\r\nexport const REGISTER_PAGE_UNLOADED = 'REGISTER_PAGE_UNLOADED';\r\nexport const ASYNC_START = 'ASYNC_START';\r\nexport const ASYNC_END = 'ASYNC_END';\r\nexport const EDITOR_PAGE_LOADED = 'EDITOR_PAGE_LOADED';\r\nexport const EDITOR_PAGE_UNLOADED = 'EDITOR_PAGE_UNLOADED';\r\nexport const ADD_TAG = 'ADD_TAG';\r\nexport const REMOVE_TAG = 'REMOVE_TAG';\r\nexport const UPDATE_FIELD_AUTH = 'UPDATE_FIELD_AUTH';\r\nexport const UPDATE_FIELD_EDITOR = 'UPDATE_FIELD_EDITOR';\r\nexport const FOLLOW_USER = 'FOLLOW_USER';\r\nexport const UNFOLLOW_USER = 'UNFOLLOW_USER';\r\nexport const PROFILE_FAVORITES_PAGE_UNLOADED = 'PROFILE_FAVORITES_PAGE_UNLOADED';\r\nexport const PROFILE_FAVORITES_PAGE_LOADED = 'PROFILE_FAVORITES_PAGE_LOADED';","import {applyMiddleware, compose, createStore} from 'redux';\r\nimport {localStorageMiddleware, promiseMiddleware} from './middleware';\r\nimport reducer from './reducer';\r\n\r\nimport {routerMiddleware} from 'connected-react-router'\r\nimport {createBrowserHistory} from 'history';\r\nimport thunk from 'redux-thunk';\r\n\r\nexport const history = createBrowserHistory();\r\n\r\nexport const store = createStore(\r\n    reducer(history),\r\n    compose(\r\n        applyMiddleware(\r\n            thunk,\r\n            routerMiddleware(history),\r\n            promiseMiddleware,\r\n            localStorageMiddleware\r\n        )\r\n    )\r\n);","import agent from './agent';\r\nimport {\r\n    ASYNC_START,\r\n    ASYNC_END,\r\n    LOGIN,\r\n    LOGOUT,\r\n    REGISTER\r\n} from './constants/actionTypes';\r\n\r\nconst promiseMiddleware = store => next => action => {\r\n    if (isPromise(action.payload)) {\r\n        store.dispatch({ type: ASYNC_START, subtype: action.type });\r\n\r\n        const currentView = store.getState().viewChangeCounter;\r\n        const skipTracking = action.skipTracking;\r\n\r\n        action.payload.then(\r\n            res => {\r\n                const currentState = store.getState();\r\n                if (!skipTracking && currentState.viewChangeCounter !== currentView) {\r\n                    return\r\n                }\r\n                console.log('RESULT', res);\r\n                action.payload = res;\r\n                store.dispatch({ type: ASYNC_END, promise: action.payload });\r\n                store.dispatch(action);\r\n            },\r\n            error => {\r\n                const currentState = store.getState();\r\n                if (!skipTracking && currentState.viewChangeCounter !== currentView) {\r\n                    return\r\n                }\r\n                console.log('ERROR', error);\r\n                action.error = true;\r\n                action.payload = error.response.body;\r\n                if (!action.skipTracking) {\r\n                    store.dispatch({ type: ASYNC_END, promise: action.payload });\r\n                }\r\n                store.dispatch(action);\r\n            }\r\n        );\r\n\r\n        return;\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nconst localStorageMiddleware = store => next => action => {\r\n    if (action.type === REGISTER || action.type === LOGIN) {\r\n        if (!action.error) {\r\n            window.localStorage.setItem('jwt', action.payload.user.token);\r\n           // agent.setToken(action.payload.user.token);\r\n        }\r\n    } else if (action.type === LOGOUT) {\r\n        window.localStorage.setItem('jwt', '');\r\n       //agent.setToken(null);\r\n    }\r\n\r\n    next(action);\r\n};\r\n\r\nfunction isPromise(v) {\r\n    return v && typeof v.then === 'function';\r\n}\r\n\r\n\r\nexport { promiseMiddleware, localStorageMiddleware }","import React from 'react';\r\nimport {Icon, Menu} from \"antd\";\r\nimport {store} from '../store';\r\nimport { push } from 'connected-react-router';\r\n\r\nclass Header extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            current: 'main'\r\n        };\r\n        this.handleClick = this.handleClick.bind(this);\r\n    }\r\n\r\n    handleClick(e) {\r\n        this.setState({\r\n            current: e.key,\r\n        });\r\n        store.dispatch(push('/'+ (e.key !== 'main' ? e.key : '') ));\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Menu onClick={this.handleClick} selectedKeys={[this.state.current]} mode=\"horizontal\">\r\n                <Menu.Item key=\"main\">\r\n                    <Icon type=\"mail\"/>\r\n                    <span>Главная</span>\r\n                </Menu.Item>\r\n                <Menu.Item key=\"profile\">\r\n                    <Icon type=\"appstore\"/>\r\n                    <span>Личный кабинет</span>\r\n                </Menu.Item>\r\n                <Menu.Item key=\"alipay\">\r\n                    <Icon type=\"appstore\"/>\r\n                    <span>Войти</span>\r\n                </Menu.Item>\r\n                <Menu.Item key=\"spells\">\r\n                    <Icon type=\"appstore\"/>\r\n                    <span>Заклинания</span>\r\n                </Menu.Item>\r\n            </Menu>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Header;","import React from 'react';\r\n\r\nclass Home extends React.Component {\r\n    render() {\r\n        return (\r\n            <div className=\"profile-page\">\r\n                Главная страница с описанием сайта\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport  default Home;","import React from 'react';\r\n\r\nclass Profile extends React.Component {\r\n    render() {\r\n        return (\r\n            <div className=\"profile-page\">\r\n                Страница с персонажем\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport  default Profile;","import React from 'react';\r\n\r\nclass Spells extends React.Component {\r\n    render() {\r\n        return (\r\n            <div className=\"profile-page\">\r\n               Заклинания\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport  default Spells;","import React from 'react';\nimport {Icon} from 'antd';\nimport Header from './Header';\nimport {connect} from 'react-redux';\nimport { Route, Switch } from 'react-router';\nimport {store} from '../store';\nimport {push} from 'connected-react-router';\nimport {APP_LOAD, REDIRECT} from '../constants/actionTypes';\nimport Home from './Home';\nimport Profile from './Profile';\nimport Spells from \"./Spells\";\n\nconst mapStateToProps = state => {\n    return {\n        appLoaded: state.common.appLoaded,\n        appName: state.common.appName,\n        currentUser: state.common.currentUser,\n        redirectTo: state.common.redirectTo\n    }\n};\n\n//createActions\nconst mapDispatchToProps = dispatch => ({\n    onLoad: (payload, token) =>\n        dispatch({type: APP_LOAD, payload, token, skipTracking: true}),\n    onRedirect: () =>\n        dispatch({type: REDIRECT})\n});\n\nclass App extends React.Component {\n    //вызывается при обновлении props\n    componentWillReceiveProps(nextProps) {\n        if (nextProps.redirectTo) {\n            store.dispatch(push(nextProps.redirectTo));\n            this.props.onRedirect();\n        }\n    }\n\n    //перед рендерингом компонента\n    componentWillMount() {\n        const token = window.localStorage.getItem('jwt');\n        if (token) {\n            //agent.setToken(token);\n        }\n\n        //this.props.onLoad(token ? agent.Auth.current() : null, token);\n    }\n\n    render() {\n        return (\n            <div>\n                <Header\n                    appName={this.props.appName}\n                    currentUser={this.props.currentUser}\n                />\n                <Switch>\n                    <Route exact path=\"/\" component={Home}/>\n                    <Route path=\"/profile\" component={Profile} />\n                    <Route path=\"/spells\" component={Spells} />\n                    <Route render={() => (<div>Not found</div>)} />\n                </Switch>\n            </div>\n        );\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","import React from 'react';\nimport { Provider } from 'react-redux';\nimport ReactDOM from 'react-dom';\nimport {ConnectedRouter} from 'connected-react-router';\nimport {Route, Switch} from 'react-router';\nimport { store, history} from './store';\nimport App from './components/App';\n//стили\nimport './index.css';\nimport 'antd/dist/antd.css';\n\nReactDOM.render((\n    <Provider store={store}>\n        <ConnectedRouter history={history}>\n            <Switch>\n                <Route path=\"/\" component={App}/>\n            </Switch>\n        </ConnectedRouter>\n    </Provider>\n), document.getElementById('root'));\n\n"],"sourceRoot":""}